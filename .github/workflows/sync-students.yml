name: Sync Students

on:
  schedule:
    - cron: "45 5 * * *" # 11:15 AM IST
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    steps:
      - name: Trigger sync
        env:
          SYNC_URL: ${{ secrets.SYNC_URL }}
          ACCESS_CODE: ${{ secrets.ACCESS_CODE }}
        run: |
          if [ -z "${SYNC_URL}" ]; then
            echo "SYNC_URL secret is missing."
            exit 1
          fi
          if [ -n "${ACCESS_CODE}" ]; then
            curl -sS -X POST "${SYNC_URL}?targets=students&min_age_minutes=30" -H "X-Access-Code: ${ACCESS_CODE}"
          else
            curl -sS -X POST "${SYNC_URL}?targets=students&min_age_minutes=30"
          fi
