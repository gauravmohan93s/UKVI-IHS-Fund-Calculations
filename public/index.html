<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>UK Visa Calculator - IHS + Funds Required + Funds Available</title>
  <link rel="stylesheet" href="/styles.css"/>
</head>
<body>
<header class="topbar">
  <div class="wrap topbar-inner">
    <div class="brand">
      <img class="logoimg" id="brandLogoImg" src="/assets/kc-logo.svg" alt="Company logo"/><div class="logo fallback" id="brandLogo" aria-hidden="true">KC</div>
      <div class="brand-text">
        <div class="brand-name" id="brandName">KC Overseas Education</div>
        <div class="brand-sub" id="brandProduct">UK Visa Funds &amp; IHS Calculator</div>
      </div>
    </div>
    <div class="topbar-right">
      <span class="pill">Student Visa</span>
      <div class="data-status muted small" id="dataStatus"></div>
    </div>
  </div>
</header>

<div class="modal-backdrop" id="accessModal" style="display:none">
  <div class="modal">
    <h3>Access Code</h3>
    <p class="muted small">Enter the internal access code to use this tool.</p>
    <label>Access code
      <input id="accessCodeInput" type="password" placeholder="Enter access code"/>
    </label>
    <div class="nav" style="justify-content:flex-end">
      <button class="primary" id="accessCodeSave">Continue</button>
    </div>
    <p class="muted small" id="accessCodeError" style="display:none;color:#b91c1c;margin-top:10px"></p>
  </div>
</div>

<main class="wrap">
  <div class="notice warn" id="formErrors" style="display:none"></div>
  <div class="tabs">
    <button class="tab active" data-tab="t1">1) Course & application</button>
    <button class="tab" data-tab="t2">2) Fees & funds</button>
    <button class="tab" data-tab="t3">3) Results & PDF</button>
  </div>

  <section class="card tabpane active" id="t1">
    <h2>IHS calculation (Course dates)</h2>
    <p class="muted small">Enter course dates to get the IHS calculation immediately. These dates also drive the full calculation later.</p>
    <div class="ihs-layout">
      <div class="ihs-card ihs-inputs">
        <div class="ihs-card-title">Inputs</div>
        <div class="form-grid ihs-grid">
          <label>Course start date (as per CAS)
            <input id="courseStart" type="date"/>
          </label>
          <label>Course end date (as per CAS)
            <input id="courseEnd" type="date"/>
            <div class="helper">Course category: <span id="ihsCourseCategory">-</span></div>
          </label>
          <label>Visa application date (optional)
            <input id="applicationDate" type="date"/>
            <div class="helper">Defaults to today if left empty.</div>
          </label>
          <label>Intended travel date (optional)
            <input id="intendedTravelDate" type="date"/>
            <div class="helper">Used only when grant is under 1 month before course start.</div>
          </label>
          <label class="span-2">Intended travel (effective)
            <input id="ihsTravelEffective" type="text" readonly/>
            <div class="helper">Auto-calculated using ST 25.3 once grant timing is known.</div>
          </label>
          <label>Visa service type
            <select id="visaServiceType">
              <option value="standard" selected>Standard (20 working days)</option>
              <option value="priority">Priority (5 working days)</option>
              <option value="super-priority">Super Priority (1 working day)</option>
            </select>
          </label>
          <label>Decision time (working days)
            <input id="visaDecisionDays" type="number" min="1" step="1"/>
            <div class="helper">Defaults to service type. Used to estimate grant date.</div>
          </label>
          <label class="span-2">Estimated grant date
            <input id="ihsGrantDate" type="text" readonly/>
          </label>
          <label class="toggle span-2">
            <input id="isPreSessional" type="checkbox"/>
            <span>Pre-sessional course (under 6 months)</span>
            <div class="helper">Used only when course duration is under 6 months.</div>
          </label>
        </div>
      </div>
      <div class="ihs-stack">
        <div class="ihs-card ihs-summary">
          <div class="ihs-card-title">IHS total</div>
          <div class="ihs-kpi">
            <div class="kpi-label">IHS Total (Quick)</div>
            <div class="kpi-value" id="ihsQuickGbp">-</div>
            <div class="kpi-sub" id="ihsQuickCalc">-</div>
          </div>
        </div>
        <div class="ihs-card ihs-timeline">
        <div class="ihs-card-title">IHS timeline (estimated)</div>
        <div class="timeline" id="ihsQuickTimeline"></div>
        <div class="muted small ihs-timeline-note"></div>
        <div class="scenario-strip">
          <div class="scenario-item full" id="ihsCurrentBox">
            <div class="scenario-title">Current IHS window</div>
            <div class="scenario-note" id="ihsCurrentText">Current IHS window details will appear here.</div>
          </div>
          <div class="scenario-item" id="ihsHigherBox">
            <div class="scenario-title">Higher IHS window</div>
            <div class="scenario-note" id="ihsHigherText">Higher IHS window details will appear here.</div>
          </div>
          <div class="scenario-item" id="ihsLowerBox">
            <div class="scenario-title">Lower IHS window</div>
            <div class="scenario-note" id="ihsLowerText">Lower IHS window details will appear here.</div>
          </div>
          <div class="scenario-item full" id="ihsNotBeforeBox">
            <div class="scenario-title">Application limit</div>
            <div class="scenario-note" id="ihsNotBeforeText">Application limit will appear here.</div>
          </div>
        </div>
      </div>
      </div>
    </div>
    <div class="ihs-rule-grid">
      <div class="ihs-card" id="ihsRuleMatrix">
        <div class="ihs-card-title">How dates impact IHS (ST 25.3 matrix)</div>
        <table class="table compact">
          <thead>
            <tr><th>Grant timing vs course start</th><th>Intended travel rule</th><th>Visa start used for IHS</th></tr>
          </thead>
          <tbody>
            <tr data-rule="a">
              <td>Grant >= 1 month before course start</td>
              <td>Intended travel not used</td>
              <td>Course start - pre-course wrap (table)</td>
            </tr>
            <tr data-rule="b">
              <td>Grant < 1 month before course start</td>
              <td>Intended travel used</td>
              <td>Intended travel - 7 days</td>
            </tr>
            <tr data-rule="c">
              <td>Grant < 7 days before intended travel</td>
              <td>Immediate effect</td>
              <td>Grant date</td>
            </tr>
          </tbody>
        </table>
        <a class="ihs-link" href="https://www.gov.uk/guidance/immigration-rules/immigration-rules-appendix-student" target="_blank" rel="noopener">Source: Appendix Student ST 25.3</a>
        <div class="muted small" style="margin-top:6px">
          Visa end date is always course end + post-course wrap (table). IHS is charged on total visa duration, rounded to 6-month blocks.
        </div>
      </div>
      <div class="ihs-card">
        <div class="ihs-card-title">ST 25.3 wrap-up periods</div>
        <table class="table compact" id="ihsWrapTable">
          <thead>
            <tr><th>Course type</th><th>Before</th><th>After</th></tr>
          </thead>
          <tbody>
            <tr data-wrap="12plus"><td>12 months or longer</td><td>1 month</td><td>4 months</td></tr>
            <tr data-wrap="6to12"><td>6 to &lt; 12 months</td><td>1 month</td><td>2 months</td></tr>
            <tr data-wrap="presess"><td>Pre-sessional &lt; 6 months</td><td>1 month</td><td>1 month</td></tr>
            <tr data-wrap="under6"><td>&lt; 6 months (not pre-sessional)</td><td>7 days</td><td>7 days</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="nav">
      <button class="primary" data-next="t2">Next ></button>
    </div>
  </section>

  <section class="card tabpane" id="t2">
    <h2>Application, Fees & Funds</h2>

    <h3>Application details</h3>
    <div class="form-grid">

      <label>Student acknowledgement number (search)
        <input id="studentAck" type="text" placeholder="Start typing acknowledgement number..." autocomplete="off"/>
        <div class="helper">Select from suggestions to auto-fill student and counselor details.</div>
        <div class="suggest" id="studentSuggest" style="display:none"></div>
      </label>

      <label>University (type to search)
        <input id="universityInput" type="text" placeholder="Start typing university name..." autocomplete="off"/>
        <div class="helper">Pick from the top 5 suggestions to auto-set London / Outside London.</div>
        <div class="suggest" id="uniSuggest" style="display:none"></div>
      </label>

      <select id="universitySelect" style="display:none">
        <option value="">Select university</option>
      </select>

      <label>Student name (auto)
        <input id="studentName" type="text" readonly/>
      </label>

      <input id="studentProgram" type="hidden"/>
      <input id="studentStatus" type="hidden"/>
      <input id="studentIntakeYear" type="hidden"/>
      <input id="studentCityCountry" type="hidden"/>

      <label>Counselor (type to search)
        <input id="counselorInput" type="text" placeholder="Start typing counselor name..." autocomplete="off"/>
        <div class="suggest" id="counselorSuggest" style="display:none"></div>
      </label>
      <input id="counselorEmail" type="hidden"/>
      <input id="counselorRegion" type="hidden"/>
      <input id="counselorDesignation" type="hidden"/>

      <label>Study location (auto from university)
        <input id="regionDisplay" type="text" value="Outside London" readonly/>
      </label>

      <label>Display currency (for sharing with student/parents)
        <select id="quote">
          <option value="INR" selected>INR - Indian Rupee (INR)</option>
          <option value="GBP">GBP - British Pound (GBP)</option>
          <option value="USD">USD - US Dollar (USD)</option>
          <option value="EUR">EUR - Euro (EUR)</option>
          <option value="BDT">BDT - Bangladeshi Taka (BDT)</option>
          <option value="PKR">PKR - Pakistani Rupee (PKR)</option>
          <option value="LKR">LKR - Sri Lankan Rupee (LKR)</option>
          <option value="NGN">NGN - Nigerian Naira (NGN)</option>
          <option value="KES">KES - Kenyan Shilling (KES)</option>
          <option value="GHS">GHS - Ghanaian Cedi (GHS)</option>
          <option value="UGX">UGX - Ugandan Shilling (UGX)</option>
          <option value="ZAR">ZAR - South African Rand (ZAR)</option>
        </select>
      </label>
    </div>

    <h3>Tuition Fee &amp; Deposit Paid</h3>
    <div class="form-grid">
      <label>Tuition fee (Total) - GBP
        <input id="tuitionTotal" type="number" min="0" step="0.01" placeholder="e.g., 18000"/>
      </label>

      <label>Tuition paid / deposit - GBP
        <input id="tuitionPaid" type="number" min="0" step="0.01" placeholder="e.g., 4000"/>
      </label>

      <label>Scholarship / waiver - GBP
        <input id="scholarship" type="number" min="0" step="0.01" placeholder="e.g., 2000"/>
      </label>

      <label>Number of dependants (if applicable)
        <input id="dependants" type="number" min="0" step="1" value="0"/>
      </label>

      <label>Buffer amount - GBP (optional)
        <input id="buffer" type="number" min="0" step="0.01" value="500"/>
      </label>
    </div>

    <hr/>
    <h2>Available Funds</h2>
    <p class="muted small">Add each fund source line (bank statement, fixed deposit, or education loan). Amount is the closing balance or sanctioned amount. We convert to GBP using live FX.</p>
    <label class="toggle">
      <input type="checkbox" id="fundsCurrencyAuto" checked/>
      <span>Auto-update fund currency when Display currency changes</span>
    </label>

    <div class="table-actions">
      <button id="addRow" class="secondary">+ Add row</button>
      <button id="clearRows" class="secondary">Clear</button>
    </div>

    <div class="table-wrap">
      <table class="table table-wide" id="fundsTable">
      <thead>
        <tr>
          <th>Fund type</th>
          <th>Account type</th>
          <th>Source/Notes</th>
          <th>Currency (full name)</th>
          <th>Closing balance amount</th>
          <th>Statement start</th>
          <th>Statement end</th>
          <th>FD maturity date</th>
          <th>Loan disbursement date</th>
          <th></th>
        </tr>
      </thead>
      <tbody></tbody>
      </table>
    </div>
    <div class="notice info" id="fundsRulesNote" style="margin-top:10px">
      Funds guidance will appear here.
    </div>

    <div class="nav">
      <button class="secondary" data-prev="t1">Back</button>
      <button class="primary" data-next="t3">Next ></button>
    </div>
  </section>

  <section class="card tabpane" id="t3">
    <h2>Results (Read-only)</h2>
    <p class="muted small">Press <strong>Calculate</strong> to refresh results, then use <strong>Download PDF</strong> to export.</p>

    <div class="buttons">
      <button id="btnCalc" class="primary">Calculate</button>
      <button id="btnPdf" class="secondary">Download PDF</button>
      <button id="btnReset" class="secondary">Reset</button>
    </div>

    <details class="fxpanel" id="fxPanel">
      <summary>FX settings (only use if live FX fails)</summary>
      <div class="notice warn" id="fxFallbackNote" style="display:none;margin-top:10px">
        Live FX is temporarily unavailable. You can retry calculation or enable manual INR-GBP rate below.
      </div>
      <div class="fxrow">
        <label class="toggle"><input type="checkbox" id="useManualFx"/><span>Use manual INR per 1 GBP</span></label>
        <input id="manualInrPerGbp" type="number" step="0.01" placeholder="e.g., 105.50" style="max-width:220px"/>
      </div>
      <label class="small" style="margin-top:8px">Manual multi-currency overrides (1 unit = GBP rate)
        <textarea id="manualFxOverrides" rows="3" placeholder="USD=0.79&#10;EUR=0.86&#10;NGN=0.00061"></textarea>
      </label>
      <p class="muted small" style="margin:8px 0 0">Overrides apply when live FX fails. Format: CURRENCY=GBP rate (1 unit of currency equals GBP).</p>
    </details>

    <div class="statusline"><div class="statusbadge neutral" id="eligibilityStatus">Status: -</div></div>

    <div class="kpi-grid">
      <div class="kpi">
        <div class="kpi-label">IHS Total</div>
        <div class="kpi-value" id="ihsGbp">-</div>
        <div class="kpi-sub" id="ihsCalc">-</div>
        <div class="kpi-sub" id="ihsFx">-</div>
      </div>
      <div class="kpi">
        <div class="kpi-label">Funds Required (28-day)</div>
        <div class="kpi-value" id="fundsReqGbp">-</div>
        <div class="kpi-sub" id="fundsReqFx">-</div>
      </div>
      <div class="kpi">
        <div class="kpi-label">Funds Available (Eligible)</div>
        <div class="kpi-value" id="fundsAvailGbp">-</div>
        <div class="kpi-sub" id="fundsAvailFx">-</div>
      </div>
      <div class="kpi">
        <div class="kpi-label" id="gapLabel">Gap (Eligible - Required)</div>
        <div class="kpi-value" id="gapGbp">-</div>
        <div class="kpi-sub" id="gapFx">-</div>
      </div>
    </div>
    <div class="two-col">
      <div class="panel">
        <h3>Fees &amp; IHS</h3>
        <table class="table compact table-2col">
            <tbody>
              <tr><td>Visa application fee</td><td id="visaFeeGbp">-</td><td>IHS total</td><td id="ihsTotalGbp">-</td></tr>
              <tr><td>Service type / decision time</td><td id="visaServiceDecisionOut">-</td><td>Estimated grant date</td><td id="grantDateOut">-</td></tr>
              <tr><td>Visa start date</td><td id="visaStartOut">-</td><td>Visa end date</td><td id="visaEndOut">-</td></tr>
            </tbody>
          </table>
        </div>
      </div>

    <h3>Funds Required Breakdown</h3>
    <table class="table dense funds-breakdown">
      <thead><tr><th>Component</th><th>GBP</th><th>Local</th></tr></thead>
      <tbody>
        <tr><td>Tuition total</td><td id="bTuitionTotalGbp">-</td><td id="bTuitionTotalFx">-</td></tr>
        <tr><td>Less: Tuition paid</td><td id="bTuitionPaidGbp">-</td><td id="bTuitionPaidFx">-</td></tr>
        <tr><td>Less: Scholarship / waiver</td><td id="bScholarshipGbp">-</td><td id="bScholarshipFx">-</td></tr>
        <tr><td>Tuition due</td><td id="bTuition">-</td><td id="bTuitionFx">-</td></tr>
        <tr><td>Maintenance (student)</td><td id="bStudent">-</td><td id="bStudentFx">-</td></tr>
        <tr><td>Maintenance (dependants)</td><td id="bDeps">-</td><td id="bDepsFx">-</td></tr>
        <tr><td>Buffer</td><td id="bBuffer">-</td><td id="bBufferFx">-</td></tr>
        <tr class="total"><td>Total required</td><td id="bTotal">-</td><td id="bTotalFx">-</td></tr>
      </tbody>
    </table>

    <h3>Funds Available Breakdown (GBP)</h3>
    <div class="table-wrap">
      <table class="table table-wide dense" id="fundsAvailBreak">
        <thead><tr><th>Status</th><th>Type</th><th>Owner</th><th>Source</th><th>Amount</th><th>Currency</th><th>GBP</th><th>Date</th><th>Issues</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="rate-panel" id="ratePanel">Loading maintenance rates...</div>

    <div class="note warn" id="validationNote"></div>
    <div class="note" id="issueSummary" style="display:none"></div>

    <div class="note" id="rulesNote"></div>
    <div class="nav">
      <button class="secondary" data-prev="t2">Back</button>
    </div>
  </section>
</main>

<footer class="wrap muted small" id="brandFooter">
  <p><strong>Internal guidance tool.</strong> Always cross-check with latest GOV.UK requirements before filing.</p>
  <p><strong>Support:</strong> Gaurav Mohan Sakhare, Senior Lead (Operation - UK Team) &middot; gsakhare@kcoverseas.com</p>
</footer>

<div class="toast" id="toast" role="status" aria-live="polite"></div>
<script src="/app.js"></script>
</body>
</html>




